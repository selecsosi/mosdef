!function(a,b){"function"==typeof define&&define.amd?define(["_"],function(c){return a.ModuleLoader=b(a,c),a.ModuleLoader}):"object"==typeof exports?module.exports=b(a,require("_")):a.ModuleLoader=b(a,_)}(this,function(a,b){"use strict";function c(a){this.name="ModulesNotFound",this.message=a}function d(a){this.name="ModulesNotFound",this.message=a}c.prototype=new Error,c.prototype.constructor=c,d.prototype=new Error,d.prototype.constructor=d;var e=function(a){this.initialize.apply(this,arguments)};return e.prototype={initialize:function(b){this.globalExportName=b,this.useGlobalExportNamespace=!!this.globalExportName,this.moduleList=[],this.useGlobalExportNamespace&&(a[this.globalExportName]=a[this.globalExportName]||{})},loadModules:function(a){for(var b,d,e=this.moduleList.slice(),f=[],g=[];e.length>0;){for(d=!1,b=0;b<e.length;b++){var h=e[b];this.tryLoadModule(h)?(d=!0,f.push(h)):g.push(h)}if(!d)break;e=g,g=[]}if(g.length>0){var i=[];for(b=0;b<g.length;b++)i.push(g[b].name);throw new c(i.join(","))}a&&a()},loadDependency:function(b,c){var d=b.split("."),e=function(a,b){return b.length>1?e(a[b[0]],b.slice(1)):1==b.length?a[b[0]]:null};return c?e(a,d):e(a[this.globalExportName],d)},tryLoadDependencies:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=null;try{e=this.loadDependency(d)}catch(f){}if(null===e||"undefined"==typeof e)try{e=this.loadDependency(d,!0)}catch(f){}if(null===e||"undefined"==typeof e){b=null;break}b.push(e)}return b},tryLoadModule:function(c,e){var f=c.name.split("."),g=this.tryLoadDependencies(c.deps);if(null!==g){var h=c.factory.apply(a,g);if(!h)throw new d("Missing module export for "+c.name);return this.useGlobalExportNamespace?a[this.globalExportName].hasOwnProperty(f[0])||(a[this.globalExportName][f[0]]={}):a.hasOwnProperty(f[0])||(a[f[0]]={}),b.merge(this.useGlobalExportNamespace?a[this.globalExportName]:a,this.loadModuleIntoNamespace(f,c.factory.apply(a,g))),!0}return!1},loadModuleIntoNamespace:function(a,b){if(a.length>0){var c={};return c[a[0]]=this.loadModuleIntoNamespace(a.slice(1),b),c}return b},define:function(a,b,c){if(!a)throw new d("Module missing definition");this.moduleList.push({name:a,deps:b,factory:c})}},e}),function(a,b){if("function"==typeof define&&define.amd)define(["ModuleLoader"],function(c){var d=b(c);return a.MosDef=d.MosDef,a.mosDef=d.mosDef,d});else if("object"==typeof exports)module.exports=b(require(["ModuleLoader"]));else{var c=b(ModuleLoader);a.MosDef=c.MosDef,a.mosDef=c.mosDef}}(this,function(a){var b=new a;return{MosDef:{ModuleLoader:b},mosDef:a.prototype.define.bind(b)}});