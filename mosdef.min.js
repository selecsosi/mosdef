!function(a,b){"function"==typeof define&&define.amd?define(["_"],function(c){return a.ModuleLoader=b(a,c),a.ModuleLoader}):"object"==typeof exports?module.exports=b(a,require("_")):a.ModuleLoader=b(a,_)}(this,function(a,b){"use strict";function c(a){this.name="ModulesNotFound",this.message=a}function d(a){this.name="ModuleDefinitionMissing",this.message=a}c.prototype=new Error,c.prototype.constructor=c,d.prototype=new Error,d.prototype.constructor=d;var e=function(){this.initialize.apply(this,arguments)};return e.prototype={initialize:function(){this.moduleList=[],this.loadErrorMap={}},loadModules:function(a){for(var b,d,e=this.moduleList.slice(),f=[],g=[];e.length>0;){for(d=!1,b=0;b<e.length;b++){var h=e[b];this.tryLoadModule(h)?(d=!0,f.push(h)):g.push(h)}if(!d)break;e=g,g=[]}if(g.length>0){var i=[];for(b=0;b<g.length;b++)i.push(g[b].name);throw console.warn("Error loading modules."),console.warn(i),console.warn(this.loadErrorMap),new c("Load terminated due to exception")}a&&a()},loadDependency:function(b){var c=b.split("."),d=function(a,b){return b.length>1?d(a[b[0]],b.slice(1)):1==b.length?a[b[0]]:null};return d(a,c)},tryLoadDependencies:function(a){for(var b=[],c=!1,d={exceptions:[]},e=0;e<a.length;e++){var f=a[e],g=null,h=null;try{g=this.loadDependency(f)}catch(i){h=i}if(null===g||"undefined"==typeof g){b=null,c=!0,h?d.exceptions.push(h):d.exceptions.push("Missing module "+f);break}b.push(g)}return c?d:b},tryLoadModule:function(c){var e=c.name.split("."),f=this.tryLoadDependencies(c.deps);if(b.isArray(f)){var g=c.factory.apply(a,f);if(!g)throw new d("Missing module export for "+c.name);return a.hasOwnProperty(e[0])||(a[e[0]]={}),b.merge(a,this.loadModuleIntoNamespace(e,c.factory.apply(a,f))),!0}return null===f||b.isArray(f)?!1:(this.loadErrorMap[c.name]=f,!1)},loadModuleIntoNamespace:function(a,b){if(a.length>0){var c={};return c[a[0]]=this.loadModuleIntoNamespace(a.slice(1),b),c}return b},define:function(a,b,c){if(!a)throw new d("Module missing definition");this.moduleList.push({name:a,deps:b,factory:c})}},e}),function(a,b){if("function"==typeof define&&define.amd)define(["ModuleLoader"],function(c){var d=b(c);return a.MosDef=d.MosDef,a.mosDef=d.mosDef,d});else if("object"==typeof exports)module.exports=b(require(["ModuleLoader"]));else{var c=b(ModuleLoader);a.MosDef=c.MosDef,a.mosDef=c.mosDef}}(this,function(a){var b=new a;return{MosDef:{ModuleLoader:b},mosDef:a.prototype.define.bind(b)}});